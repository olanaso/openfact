{
  "allowRemoteResourceManagement": true,
  "policyEnforcementMode": "ENFORCING",
  "resources": [
    {
      "name": "Profile Resource",
      "uri": "/profile",
      "type": "http://openfact.com/profile",
      "scopes": [
        {
          "name": "urn:openfact.com:scopes:profile:view"
        }
      ]
    },
    {
      "name": "User Resource",
      "uri": "/users/*",
      "type": "http://openfact.com/users",
      "scopes": [
        {
          "name": "urn:openfact.com:scopes:user:view"
        },
        {
          "name": "urn:openfact.com:scopes:user:edit"
        },
        {
          "name": "urn:openfact.com:scopes:user:create"
        },
        {
          "name": "urn:openfact.com:scopes:user:delete"
        }
      ]
    },
    {
      "name": "Organization Resource",
      "uri": "/organizations/*",
      "type": "http://openfact.com/organizations",
      "scopes": [
        {
          "name": "urn:openfact.com:scopes:organization:view"
        },
        {
          "name": "urn:openfact.com:scopes:organization:manage"
        },
        {
          "name": "urn:openfact.com:scopes:organization:delete"
        }
      ]
    },
    {
      "name": "Organization Master",
      "uri": "/organizations/master",
      "type": "http://openfact.com/organizations",
      "scopes": [
        {
          "name": "urn:openfact.com:scopes:organization:view"
        },
        {
          "name": "urn:openfact.com:scopes:organization:manage"
        },
        {
          "name": "urn:openfact.com:scopes:organization:delete"
        }
      ]
    },
    {
      "name": "Server Info Resource",
      "uri": "/serverinfo",
      "type": "http://openfact.com/serverinfo",
      "scopes": [
        {
          "name": "urn:openfact.com:scopes:serverinfo:view"
        }
      ]
    },
    {
      "name": "Peru Sunat Services",
      "uri": "/pe/sunat/*",
      "type": "http://openfact.com/pe/sunat",
      "scopes": [
        {
          "name": "urn:openfact.com:scopes:pesunat:view"
        }
      ]
    }
  ],
  "policies": [
    {
      "name": "Only Owner Policy",
      "description": "Defines that only the resource owner is allowed to do something",
      "type": "js",
      "logic": "POSITIVE",
      "decisionStrategy": "UNANIMOUS",
      "config": {
        "code": "var context = $evaluation.getContext();\nvar identity = context.getIdentity();\nvar permission = $evaluation.getPermission();\n\nif (permission.getResource() && permission.getResource().getOwner() == identity.getId()) {\n    $evaluation.grant();\n}"
      }
    },
    {
      "name": "Only User Policy",
      "description": "Defines that only users with role[user] are allowed to access",
      "type": "role",
      "logic": "POSITIVE",
      "decisionStrategy": "UNANIMOUS",
      "config": {
        "roles": "[{\"id\":\"user\",\"required\":true}]"
      }
    },
    {
      "name": "Any User Policy",
      "description": "Defines that only users from well known clients are allowed to access",
      "type": "role",
      "logic": "POSITIVE",
      "decisionStrategy": "UNANIMOUS",
      "config": {
        "roles": "[{\"id\":\"user\"},{\"id\":\"manage-organizations\",\"required\":true}]"
      }
    },
    {
      "name": "Any Admin Policy",
      "description": "Defines that administrators can do something",
      "type": "role",
      "logic": "POSITIVE",
      "decisionStrategy": "UNANIMOUS",
      "config": {
        "roles": "[{\"id\":\"admin\",\"required\":true}]"
      }
    },
    {
      "name": "Only Owner and Administrators Policy",
      "description": "Defines that only the resource owner and administrators can do something",
      "type": "aggregate",
      "logic": "POSITIVE",
      "decisionStrategy": "AFFIRMATIVE",
      "config": {
        "applyPolicies": "[\"Any Admin Policy\",\"Only Owner Policy\"]"
      }
    },
    {
      "name": "User Resource Permission",
      "description": "General policies that apply to all user resources.",
      "type": "resource",
      "logic": "POSITIVE",
      "decisionStrategy": "AFFIRMATIVE",
      "config": {
        "defaultResourceType": "http://openfact.com/users",
        "default": "true",
        "applyPolicies": "[\"Any User Policy\",\"Any Admin Policy\"]"
      }
    },
    {
      "name": "Delete User Permission",
      "description": "A policy that only allows the owner to delete himself.",
      "type": "scope",
      "logic": "POSITIVE",
      "decisionStrategy": "UNANIMOUS",
      "config": {
        "applyPolicies": "[\"Only Owner and Administrators Policy\"]",
        "scopes": "[\"urn:openfact.com:scopes:user:delete\"]"
      }
    },
    {
      "name": "Organization Resource Permission",
      "description": "General policies that apply to all organization resources.",
      "type": "resource",
      "logic": "POSITIVE",
      "decisionStrategy": "AFFIRMATIVE",
      "config": {
        "defaultResourceType": "http://openfact.com/organizations",
        "default": "true",
        "applyPolicies": "[\"Any User Policy\",\"Any Admin Policy\"]"
      }
    },
    {
      "name": "Manage and Delete Organization Permission",
      "description": "A policy that only allows the owner to manage or delete his organizations.",
      "type": "scope",
      "logic": "POSITIVE",
      "decisionStrategy": "UNANIMOUS",
      "config": {
        "applyPolicies": "[\"Only Owner and Administrators Policy\"]",
        "scopes": "[\"urn:openfact.com:scopes:organization:manage\", \"urn:openfact.com:scopes:organization:delete\"]"
      }
    },
    {
      "name": "View User Permission",
      "description": "Defines who is allowed to view an user profile",
      "type": "scope",
      "logic": "POSITIVE",
      "decisionStrategy": "AFFIRMATIVE",
      "config": {
        "applyPolicies": "[\"Only User Policy\", \"Any Admin Policy\"]",
        "scopes": "[\"urn:openfact.com:scopes:profile:view\"]"
      }
    },
    {
      "name": "View Server Info Permission",
      "description": "Defines who is allowed to view the server info",
      "type": "scope",
      "logic": "POSITIVE",
      "decisionStrategy": "UNANIMOUS",
      "config": {
        "applyPolicies": "[\"Only User Policy\"]",
        "scopes": "[\"urn:openfact.com:scopes:serverinfo:view\"]"
      }
    },
    {
      "name": "View Peru SUNAT info Permission",
      "description": "Defines who is allowed to view Per√∫ SUNAT info",
      "type": "scope",
      "logic": "POSITIVE",
      "decisionStrategy": "UNANIMOUS",
      "config": {
        "applyPolicies": "[\"Only User Policy\"]",
        "scopes": "[\"urn:openfact.com:scopes:pesunat:view\"]"
      }
    }
  ],
  "scopes": [
    {
      "name": "urn:openfact.com:scopes:profile:view"
    },
    {
      "name": "urn:openfact.com:scopes:organization:view"
    },
    {
      "name": "urn:openfact.com:scopes:organization:manage"
    },
    {
      "name": "urn:openfact.com:scopes:organization:delete"
    },
    {
      "name": "urn:openfact.com:scopes:user:view"
    },
    {
      "name": "urn:openfact.com:scopes:user:create"
    },
    {
      "name": "urn:openfact.com:scopes:user:edit"
    },
    {
      "name": "urn:openfact.com:scopes:user:delete"
    },
    {
      "name": "urn:openfact.com:scopes:serverinfo:view"
    },
    {
      "name": "urn:openfact.com:scopes:pesunat:view"
    }
  ]
}